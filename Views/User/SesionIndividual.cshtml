@{
    Layout = null;
}

@using Models;
@using Newtonsoft.Json;

@{
    var ListedCompanies = ViewBag.ListedCompanies as IEnumerable<Company>;
}

@model Models.Individual

<html>

<head>

</head>

<body>

    @{
        Individual Individual = (Individual)Model;
        var pin = Individual.CNP;
    }

    <script src="~/Scripts/jquery-3.4.1.min.js"></script>
    <script src="~/Scripts/jquery.validate.min.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
    <link href="~/Content/bootstrap.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.10.20/datatables.min.css" />
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.20/datatables.min.js"></script>

    <script>
        $(document).ready(function () {

            
            $.get('@Url.Action("PortofolioGraph", "User", new { cnp = pin })', function (response) {

               
                var labels = [];
                var data = [];

                for (var i = 0; i < response.length; i++) {
                    labels.push(response[i].CompanyName);
                    data.push(response[i].Quantity);
                }
            
                var ctxD = document.getElementById("doughnutChart");
                var myLineChart = new Chart(ctxD, {

                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: ["#F7464A", "#46BFBD", "#FDB45C", "#949FB1", "#4D5360"],
                            hoverBackgroundColor: ["#FF5A5E", "#5AD3D1", "#FFC870", "#A8B3C5", "#616774"]
                        }]
                    },
                    options: {
                        responsive: true
                    }
                });
            });

        });
    </script>

    <div style="width:500px">
        <canvas id="doughnutChart" width="500" height="300"></canvas>
    </div>

    <div style="width:70% ; float :left">
        <table id="verticalScroll" class="table table-striped table-bordered table-sm" cellspacing="0">
            <thead class="thead-dark">
                <tr>
                    <th>
                        CompanyName
                    </th>
                    <th>
                        SharePrice
                    </th>
                    <th>
                        NumberOfTotalShares
                    </th>
                    <th>
                        SharesOnInitialIPO
                    </th>
                    <th>
                        Details
                    </th>

                </tr>
            </thead>
            <tbody>

                @foreach (Company o in ListedCompanies)
                {
                    <tr>
                        <td>
                            @o.CompanyName
                        </td>
                        <td>
                            @o.MarketSharePrice
                        </td>
                        <td>
                            @o.NumberOfTotalShares
                        </td>
                        <td>
                            @o.SharesOnInitialIPO
                        </td>
                        <td>


                            <button type="button" value="Details" class="btn btn-primary"
                                    onclick="location.href='@Url.Action("CompanyDetails","User", new Transaction {CNP = Individual.CNP,CUI = o.CUI })'">
                                Details
                            </button>

                        </td>

                    </tr>
                }

            </tbody>
        </table>
    </div>

    <div style="float:left" class="form-inline">
       @Html.Action("PartialViewBID", "User", new { cnp = pin })
    </div>

</body>

</html>