@{
    Layout = null;
}

@using Models;
@model Models.CompanyFinancialDetails
@{
    var list = ViewBag.CFD_List as IEnumerable<CompanyFinancialDetails>;
    var company = ViewBag.Company as Company;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Main</title>
</head>
<body>
    <script src="~/Scripts/jquery-3.4.1.min.js"></script>
    <script src="~/Scripts/jquery.validate.min.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
    <link href="~/Content/bootstrap.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.10.20/datatables.min.css" />
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.20/datatables.min.js"></script>


    <link rel="stylesheet" href="~/Scripts/amcharts/style.css" type="text/css">
    <script src="~/Scripts/amcharts/amcharts.js" type="text/javascript"></script>
    <script src="~/Scripts/amcharts/serial.js" type="text/javascript"></script>
    <script src="~/Scripts/amcharts/amstock.js" type="text/javascript"></script>
    <script src="~/Scripts/jquery-dateFormat.js" type="text/javascript"></script>

    <script>
        $(document).ready(function () {

                $('#verticalScroll').DataTable({
                    "scrollY": "50vh",
                    "scrollCollapse": true,
                });

                $('.dataTables_length').addClass('bs-select');

               $('#verticalScroll_2').DataTable({
                    "scrollY": "50vh",
                    "scrollCollapse": true,
               });

                var cl = @(company.IsListed?"true":"false")

                if(cl == true) {
                    $('#CompanyListing').hide()
                    $('#State').html("Listata")
                } else {
                    $('#State').html("Nelistata")
                }

                 $.get('@Url.Action("GraphData", "User", new { cui = company.CUI })', function (response) {

                         var date = [];
                         var value = [];

                        for (var i = 0; i < response.length; i++) {

                            date.push($.format.date(new Date(parseInt(response[i].Date.substr(6))), "dd/MM/yyyy"));

                            value.push(response[i].ClosingPrice);
                        }

                        console.log(date)

                        var ctxL = document.getElementById("lineChart").getContext('2d');
                        var myLineChart = new Chart(ctxL, {
                            type: 'line',
                            data: {
                                labels: date,
                                datasets: [{
                                    label: "Closing Price",
                                    data: value,
                                    backgroundColor:'rgba(105, 0, 132, .2)',
                                    borderColor:'rgba(200, 99, 132, .7)',
                                    borderWidth: 2
                                }
                                ]
                            },
                            options: {
                                responsive: true
                            }
                        });


                 });

        });

    </script>



    <div class="container table-bordered">
        <div class="row">
            <div class="col-sm-3 border">
                <div>
                    <table class="table">
                        <tbody>
                            <tr>
                                <td>
                                    CUI:
                                </td>
                                <td>
                                    @company.CUI
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Simbol:
                                </td>
                                <td>
                                    @company.Simbol
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Segment:
                                </td>
                                <td>
                                    Principal
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Numar Actiuni:
                                </td>
                                <td>
                                    @company.NumberOfTotalShares
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Stare:
                                </td>
                                <td id="State">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>


            <div class="col-sm-3 border">
                <div>
                    <table class="table">
                        <tbody>
                            <tr>
                                <td>
                                    Nume Companie:
                                </td>
                                <td>
                                    @company.CompanyName
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Pret Nominal Actiune:
                                </td>
                                <td>
                                    @company.NominalSharePrice
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Pret in piata Actiune:
                                </td>
                                <td>
                                    @company.MarketSharePrice
                                </td>
                            </tr>
                            <tr>
                                <td style="padding-left:15%">
                                    @DateTime.Now
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="col-sm-3 border">c</div>
            <div class="col-sm-3 border">d</div>
        </div>
    </div>

    <div style="width:70% ; float :left">
        <table id="verticalScroll" class="table table-striped table-bordered table-sm" cellspacing="0">
            <thead class="thead-dark">
                <tr>
                    <th>
                        @Html.DisplayNameFor(model => model.GrossProfit)

                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.NetProfit)
                    </th>
                </tr>
            </thead>
            <tbody>
                @if (ViewBag.CFD_List != null)
                {
                    foreach (CompanyFinancialDetails o in list)
                    {

                        <tr>
                            <td>
                                @Html.DisplayFor(model => o.GrossProfit)
                            </td>
                            <td>
                                @Html.DisplayFor(model => o.NetProfit)
                            </td>
                        </tr>

                    }

                }

            </tbody>
        </table>
    </div>



    <div id="CompanyListing">
        @Html.Partial("CompanyListing")
    </div>

    @using (Html.BeginForm("UploadCompanyDetails", "User", FormMethod.Post, new { enctype = "multipart/form-data" }))
    {
        <input type="file" name="file" />
        <input type="submit" value="OK" class="btn btn-primary active" />
    }

    <div style="height:1200px;width:1400px">
        <canvas id="lineChart"></canvas>
    </div>


</body>
</html>
